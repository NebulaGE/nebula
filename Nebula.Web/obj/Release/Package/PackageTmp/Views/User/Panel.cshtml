<link href="~/Content/assetsNew/css/chart.css" rel="stylesheet" />
<link href="~/Content/assetsNew/css/bootstrapgrid.css" rel="stylesheet" />
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="~/Content/assetsNew/js/chart.js"></script>
<script src="~/Content/assetsNew/js/my.js"></script>

@{
    ViewBag.Title = "Panel";
}

<div class="main-page-chart">
<div class="chart-background">
    <div class="chart-user-div">
        <img data-bind="attr : { src : iconSrc }" class="chart-circle-user">
        <div class="email-username-div">
            <div class="chart-username" data-bind="text : fullName"></div>
         
        </div>
        <div class="chart-news-div">
            <div class="chart-circle-news">
                <div class="number-news" data-bind="click : notifications().length"></div>

            </div>
            <div class="chart-new-message">ახალი შეტყობინება</div>
        </div>
    </div>
</div>
<div class="main-chart-div">
<div id="chart-div"></div>
<div class="top-div-chart">
    <div class="buy-course-nebula-chart">
        <div class="text-name-chart">ტესტები უნარებში</div>
    </div>
    <div class="select-course-div-chart">
        <div class="items-chart">
            <div class="active-circle-chart">
                <div class="point-chart"></div>
            </div>
            <div class="text-items-chart-active">ზოგადი უნარები</div>
        </div>
        @*<div class="items-chart">
            <div class="active-circle-chart" style="display: none">
                <div class="point-chart"></div>
            </div>
            <div class="text-items-chart-passive">ქართული</div>
        </div>
        <div class="items-chart">
            <div class="active-circle-chart" style="display: none">
                <div class="point-chart"></div>
            </div>
            <div class="text-items-chart-passive">ინგლისური</div>
        </div>*@
    </div>
</div>
    <div class="correct-answers-div row" >
        <!-- ko foreach: userQuizzes -->
        <a data-bind="attr : { href :  $root.showSample() != null ? '#' : url  }, css : { 'not-allowed' : $root.showSample() != null }">
        <div class="col-hg-3 col-lg-4 col-md-6">
            <div id="correct-answres-main">
                <div class="test-numeration">
                    <div class="number-for-test" data-bind="text : examNum"></div>
                    <div class="text-test">ტესტი</div>
                </div>
                <div class="number-correct-answers-circle">
                    <div class="correct" data-bind="text: correctAnswersCount" ></div>
                </div>
                <div class="text-correct">სწორი</div>
                <div class="date-cont">
                    <div class="logo-date-name"></div>
                    <div class="text-date" data-bind="text : date"></div>
                </div>
                <button class="button-correct">
                    <div class="arrow-image"></div>
                </button>
            </div>
        </div>
            </a>
        <!-- /ko -->
        <a href="@Url.Action("AllExams", "User")" data-bind="visible: userQuizzes().length >0,
                                                                     css : { 'not-allowed' : showSample() != null},
                                                                     attr : { href : showSample() != null ? '#' : U + 'User/AllExams' }">          
        <div class="col-hg-3 col-lg-4 col-md-6">
            <div id="correct-answres-main">
                <div id="see-all-text">ყველა ტექსტის ნახვა</div>
                <div class="arrow-image"></div>
            </div>
        </div>
       </a>
</div>
@*<div class="top-div-chart">
    <div class="buy-course-nebula-chart">
        <div class="text-name-chart">თეორიული სავარჯიშოები მათემატიკაში</div>
    </div>
</div>
<div class="row">
    <div class="col-md-6 col-sm-12">
        <div class="video-blocks-chart">
            <div class="circle-filled-chart"></div>
            <div class="arrow-right-chart"></div>
            <div class="text-for-blocks-chart">ნატურალური რიცხვები</div>
            <div class="progress-numbers-chart">19/40</div>
            <progress value="78" max="100" class="progress-chart"></progress>
        </div>
    </div>
    <div class="col-md-6 col-sm-12">
        <div class="video-blocks-chart">
            <div class="circle-filled-chart"></div>
            <div class="arrow-right-chart"></div>
            <div class="text-for-blocks-chart">ნატურალური რიცხვები</div>
            <div class="progress-numbers-chart">19/40</div>
            <progress value="78" max="100" class="progress-chart"></progress>
        </div>
    </div>
    <div class="col-md-6 col-sm-12">
        <div class="video-blocks-chart">
            <div class="circle-filled-chart"></div>
            <div class="arrow-right-chart"></div>
            <div class="text-for-blocks-chart">ნატურალური რიცხვები</div>
            <div class="progress-numbers-chart">19/40</div>
            <progress value="78" max="100" class="progress-chart"></progress>
        </div>
    </div>
    <div class="col-md-6 col-sm-12">
        <div class="video-blocks-chart">
            <div class="circle-filled-chart"></div>
            <div class="arrow-right-chart"></div>
            <div class="text-for-blocks-chart">ნატურალური რიცხვები</div>
            <div class="progress-numbers-chart">19/40</div>
            <progress value="78" max="100" class="progress-chart"></progress>
        </div>
    </div>
    <div class="col-md-6 col-sm-12">
        <div class="video-blocks-chart">
            <div class="circle-filled-chart"></div>
            <div class="arrow-right-chart"></div>
            <div class="text-for-blocks-chart">ნატურალური რიცხვები</div>
            <div class="progress-numbers-chart">19/40</div>
            <progress value="78" max="100" class="progress-chart"></progress>
        </div>
    </div>
    <div class="col-md-6 col-sm-12">
        <div class="video-blocks-chart">
            <div class="circle-filled-chart"></div>
            <div class="arrow-right-chart"></div>
            <div class="text-for-blocks-chart">ნატურალური რიცხვები</div>
            <div class="progress-numbers-chart">19/40</div>
            <progress value="78" max="100" class="progress-chart"></progress>
        </div>
    </div>
</div>*@
</div>
</div>


@Html.Partial("_FooterPartial", 1)
@section scripts{
    <script src="~/Scripts/canvasjs.min.js"></script>
    <script src="~/Scripts/circles.min.js"></script>
    <script>
                pageLoading(true);

                    function userQuizzesViewModel() {
                        var self = this;
                        self.correctAnswersCount = 0;
                        self.incorrectAnswersCount = 0;
                        self.examNum = 0;
                        self.date = '';
                        self.url = '';
                    }
                    function userPanlenViewModel() {
                        var self = this;
                        self.fullName = ko.observable('');
                        self.showSample = ko.observable(null);
                        self.facebookId = ko.observable(null);
                        self.iconSrc = ko.observable(U + 'Content/img/user.png')
                        self.hasLicense = ko.observable(false);
                        self.scores = ko.observableArray();
                        self.expectedScore = ko.observable();
                        self.expectedPercent = ko.observable();
                        self.resultViewhelper = ko.observable(3);
                        self.notifications = ko.observableArray();
                        self.userQuizzes = ko.observableArray();
                        circles = [];
                        self.color = ['#BEE3F7', '#45AEEA'];
                        self.firstThreeVideos = ko.observableArray();
                        self.secondThreeVideos = ko.observableArray();

                        self.goToVideo = function (item) {
                            location = U + 'video/index?ModuleId=' + item.id;
                        }

                        $.getJSON(U + 'User/UserPanelData', function (response) {


                            self.showSample(response.showSample);
                            if (response.showSample) {
                                self.fullName("სახელი გვარი");
                            } else {
                                self.fullName(response.fullName);
                            }
                            if (response.facebookId)
                                self.iconSrc("https://graph.facebook.com/"+response.facebookId+"/picture?width=90&amp;height=90");

                            self.facebookId(response.facebookId);

                            $.each(response.userQuizzes, function (i, v) {
                                var examNum = '0' + (i + 1);

                                var model = new userQuizzesViewModel();
                                model.examNum = examNum;
                                model.date = v.date;
                                model.correctAnswersCount = v.correctAnswersCount;
                                model.incorrectAnswersCount = v.incorrectAnswersCount;
                                model.date = v.date;
                                model.url = U + 'Exam/Result?quizId=' + v.id + '&returnUrl=' + U + 'User/Panel';
                                self.userQuizzes.push(model);

                            });

                            ko.utils.arrayForEach(response.verbalResult, function (item) {
                                self.scores.push({ module: item.module, percent: Math.round(item.percent) });
                            });

                            ko.utils.arrayForEach(response.mathResult, function (item) {
                                self.scores.push({ module: item.module, percent: Math.round(item.percent) });
                            });

                            self.expectedScore(Math.round(response.expectedScore));

                            self.expectedPercent(Math.round(self.expectedScore() / 80 * 100));

                            self.hasLicense(response.hasLicense);

                            //$.each(response.finalResult, function (i, v) {
                            //    if (i <= 2) {
                            //        self.firstThreeVideos.push({ name: v.name, id: v.id, percent: Math.round(v.percent), isPayed : v.isPayed, index : i });
                            //    } else {
                            //        self.secondThreeVideos.push({ name: v.name, id: v.id, percent: Math.round(v.percent), isPayed: v.isPayed, index : i });
                            //    }

                            //    if (!v.isPayed || response.hasLicense) {
                            //        var child = document.getElementById('circles-' + i);

                            //        circles.push(Circles.create({
                            //            id: child.id,
                            //            value: v.percent,
                            //            radius: 30,
                            //            width: 5,
                            //            colors: self.color
                            //        }));
                            //    }

                            //});

                            console.log('notifications', response.notifications);

                            self.notifications(response.notifications);

                            setTimeout(function () {
                                var dataPoints = [];
                                if (response.userQuizzesChart.length) {
                                    var interval = response.userQuizzesChart.length;
                                    $('#chartContainer').show();
                                    $.each(response.userQuizzesChart, function (i, v) {

                                        //ex   { x: new Date(2016, 02, 2), y: 36 },
                                        //if (v.month < 10)
                                        //    v.month = (parseInt('0' + v.month, 10));

                                        console.log('year', v.year);
                                        console.log('day', v.day);
                                        console.log('month', v.month);
                                        dataPoints.push({ x: new Date(v.year, v.month, v.day), y: v.score });



                                    });
                                    console.log('datapoints', dataPoints);
                                    CanvasJS.addCultureInfo("ka",
                                            {

                                                shortMonths: ["იანვარი", "თებერვალი", "მარტი", "აპრილი", "მაისი", "ივნისი", "ივლისი", "აგვისტო", "სექტემბერი", "ოქტომბერი"
                                                    , "ნოემბერი", "დეკემბერი"]

                                            });
                                    var chart = new CanvasJS.Chart("chartContainer",
                                         {
                                             culture: "ka",

                                             title: {
                                                 text: "ყველა გამოცდა"
                                             },
                                             axisY: {
                                                 title: "ქულა",

                                             },
                                             axisX: {
                                                 valueFormatString: "DD-MMM",
                                                 labelAngle: -50,
                                                 interval: 1
                                             },
                                             data: [
                                             {
                                                 type: "line",

                                                 dataPoints: dataPoints
                                             }
                                             ]
                                         });

                                    chart.render();
                                }
                            }, 500);


                        }).done(function () {

                            initPlayButtonsColor();
                            collapseClick();
                            pageLoading(false);
                        });
                    }
                    ko.applyBindings(new userPanlenViewModel());

    </script>
}














